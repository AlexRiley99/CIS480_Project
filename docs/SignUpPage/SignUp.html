<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../styles.css">
        <link rel="stylesheet" href="SignUp.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <script src="SignUp.js" defer></script>
        <script src="../scripts.js" defer></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
        <title>Flex & Flow Fitness - Sign Up</title>
    </head>
    <body>
        <nav class="navbar">
            <div class="logoContainerDiv">
                <img src="../Images/Logo.png" alt="Company Logo" id="Logo">
            </div>
            
            <div class="navButtonsDiv">
                <button id="landingNav" class="navigation" onclick="location.href='../LandingPage/LandingPage.html'" >Home</button>
                <button id="aboutNav" class="navigation" onclick="location.href='../AboutPage/About.html'" >About</button>
                <button id="classesNav" class="navigation" onclick="location.href='../ClassesPage/Classes.html'" >Classes</button>
                <button id="accountNav" class="navigation" onclick="location.href='../LoginPage/Login.html'" >Log In</button>
                <button id="plansNav" class="navigation" onclick="location.href='../PlansPage/Plans.html'" >Plans</button>
            </div>
        </nav>
        <button id="addButton">Add Existing Documents</button>
        <h1>Sign Up</h1>
        <div class="formContainer">
            <form id="signupForm" onsubmit="">
                <fieldset id="selectAPlan">
                    <legend for="selectAPlan">Select A Plan</legend>
                    <label for="plans">Selected Plan: </label>
                    <select id="plans" name="plans">
                        <option value="silverPlan">Silver Plan - $19.99</option>
                        <option value="goldPlan">Gold Plan - $29.99</option>
                        <option value="platinumPlan">Platinum Plan - $39.99</option>
                        <option value="diamondPlan">Diamond Plan - $49.99</option>
                    </select>
                    <button id="plansNav" class="navigation" onclick="location.href='../PlansPage/Plans.html'" >View Plan Details</button>
                </fieldset>
                <fieldset id="enterInfo">
                    <legend for="enterInfo">Enter Your Information</legend>
                    <label for="firstName">First Name: </Label>
                    <input type="text" id="firstName" name="firstName" required><br>
                    <label for="lastName">Last Name: </Label>
                    <input type="text" id="lastName" name="lastName" required><br>
                    <label for="email">Email: </label>
                    <input type="email" id="email" name="email" placeholder="example@email.com" required><br>
                    <label for="phone">Phone Number: </label>
                    <input type="tel" id="phone" name="phone" placeholder="xxx-xxxx-xxxx" required><br>
                </fieldset>

                <fieldset id="loginInfo">
                    <legend for="loginInfo">Set Your Log In Credentials</legend>
                    <label for="username">Username: </label>
                    <input type="text" id="username" name="username" required><br>
                    <label for="password">Password: </label>
                    <input type="password" id="password" name="password" required><br>
                        <div id="passwordRequirements">
                            <h6 class="passwordReqirements" id="passReqHeader">Password Requirements:</h5>
                            <h6 id="lengthReq" class="passwordReqirements">At least 8 characters</h6>
                            <h6 id="upperReq" class="passwordReqirements">At least one uppercase letter</h6>
                            <h6 id="lowerReq" class="passwordReqirements">At least one lowercase letter</h6>
                            <h6 id="numReq" class="passwordReqirements">At least one number</h6>
                            <h6 id="specCharReq" class="passwordReqirements">At least one special character (!@#$%^&*)</h6>

                        </div>
                    <label for="confirmPassword">Confirm Password: </label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required><br>
                </fieldset>

                <fieldset id="paymentInfo">
                    <legend for="paymentInfo">Payment Information</legend>
                    <label for="nameOnCard">Cardholder's Name: </label>
                    <input type="text" id="nameOnCard" name="nameOnCard" required><br>
                    <label for="cardNumber">Card Number: </label>
                    <input type="text" id="cardNumber"  name="cardNumber" placeholder="xxxx xxxx xxxx xxxx" required><br>
                    <label for="expDate">Expiration Date: </label>
                    <input type="text" id="expDate" name="expDate" placeholder="MM/yy" required><br>
                    <label for="cvv">CVV: </label>
                    <input type="text" id="cvv" name="cvv" placeholder="xxx" required><br>
                </fieldset>

                <fieldset id="billing">
                    <legend for="billingAddress">Billing Address</legend>
                    <label for="addr1">Address Line 1: </label>
                    <input type="text" id="addr1" name="addr1"><br>
                    <label for="addr2">Address Line 2: </label>
                    <input type="text" id="addr2" name="addr2"><br>
                    <label for="city">City: </label>
                    <input type="text" id="city" name="city"><br>
                    <label for="state">State: </label>
                    <select id="state" name="state" required>
                        <option value="Alabama">Alabama</option>
                        <option value="Alaska">Alaska</option>
                        <option value="Arizona">Arizona</option>
                        <option value="Arkansas">Arkansas</option>
                        <option value="California">California</option>
                        <option value="Colorado">Colorado</option>
                        <option value="Connecticut">Connecticut</option>
                        <option value="Delaware">Delaware</option>
                        <option value="District Of Columbia">District Of Columbia</option>
                        <option value="Florida">Florida</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Hawaii">Hawaii</option>
                        <option value="Idaho">Idaho</option>
                        <option value="Illinois">Illinois</option>
                        <option value="Indiana">Indiana</option>
                        <option value="Iowa">Iowa</option>
                        <option value="Kansas">Kansas</option>
                        <option value="Kentucky">Kentucky</option>
                        <option value="Louisiana">Louisiana</option>
                        <option value="Maine">Maine</option>
                        <option value="Maryland">Maryland</option>
                        <option value="Massachussetts">Massachussetts</option>
                        <option value="Michigan">Michigan</option>
                        <option value="Minnesota">Minnesota</option>
                        <option value="Mississippi">Mississippi</option>
                        <option value="Missouri">Missouri</option>
                        <option value="Montana">Montana</option>
                        <option value="Nebraska">Nebraska</option>
                        <option value="Nevada">Nevada</option>
                        <option value="New Hampshire">New Hampshire</option>
                        <option value="New Jersey">New Jersey</option>
                        <option value="New Mexico">New Mexico</option>
                        <option value="New York">New York</option>
                        <option value="North Carolina">North Carolina</option>
                        <option value="North Dakota">North Dakota</option>
                        <option value="Ohio">Ohio</option>
                        <option value="Oklahoma">Oklahoma</option>
                        <option value="Oregon">Oregon</option>
                        <option value="Pennsylvania">Pennsylvania</option>
                        <option value="Rhode Island">Rhode Island</option>
                        <option value="South Carolina">South Carolina</option>
                        <option value="South Dakota">South Dakota</option>
                        <option value="Tennessee">Tennessee</option>
                        <option value="Texas">Texas</option>
                        <option value="Utah">Utah</option>
                        <option value="Vermont">Vermont</option>
                        <option value="Virginia">Virginia</option>
                        <option value="Washington">Washington</option>
                        <option value="West Virginia">West Virginia</option>
                        <option value="Wisconsin">Wisconsin</option>
                        <option value="Wyoming">Wyoming</option>
                    </select><br>
                    <label for="zip">Zip Code: </label>
                    <input type="type" id="zip" name="zip"><br>
                </fieldset>
                <div id=buttonContainer>
                    <input type="submit" id="signUp" value="Submit">
                    <input type="reset" id="clear" value="Clear">
                </div>
            </form>
            <h5 class="erroMsg" id="error"></h5>
        </div>
        <footer>
            <div class="footerDiv">
                <h6 class="footer">Alex Riley | October 2024 | CIS480 Software Development Capstone | ECPI University</h6>>
            </div>
        </footer>
        <script>
            //Firebase configuration
const {firebaseConfig} = require("./Database/firebase");
const {initializeApp} = require("./Database/firebase");
const {getFirestore, doc, setDoc, getDoc, getDocs, collection} = require("firebase/firestore");

//Import password validation function from SignUp.js

//Add existing documents
async function addExistingDocuments(collectionName){
    //Create reference to document in "Counters" collection
    //Document name is based on collection name (ex. MembersCounter)
    const counterRef = db.collection('Counters').doc(`${collectionName}Counter`);

    await initializeCounter(counterRef);

    const snapshot = await db.collection(collectionName).get();
    let count = 0;

    //loop through existing documents
    snapshot.forEach(async (doc) => {
        count += 1; //increment count for each document
        const data = doc.data();
    });

    //Create new document with auto-incremented ID
    await db.collection(collectionName).doc().add({
        ...data,
        [`${collectionName}ID`]: count
    });

        //Update counter document with new count
        await counterRef.add({ count: count }, {merge:true});
        console.log(`Added document to ${collectionName} with auto-incremented ID. ID = ${count}`);
}

//Auto-increment ID numbers for new documents
async function addDocumentWithAutoIncrement(collectionName, data) {
    // Initialize counter if it doesn't exist
    async function initializeCounter(counterRef) {
        const counterDoc = await getDoc(counterRef);
        // Check if the counter document exists; if not, create it
        if (!counterDoc.exists()) {
            await addDoc(counterRef, { count: 0 }); // Initialize count to 0
        }
    }
    //Create reference to document in "Counters" collection
    //Document name is based on collection name (ex. MembersCounter)
    const counterRef = db.collection('Counters').doc(`${collectionName}Counter`);

    await initializeCounter(counterRef);

    //Transactions ensure that multiple users can create documents at the same time
    const newCount = await db.runTransaction(async (transaction) => {
        //Get current count
        const counterDoc = await transaction.get(counterRef);
        const newCount = counterDoc.data().count + 1; //Increment count by 1

        //Update counter document with new count
        transaction.update(counterRef, { count: newCount });
        //add new document
        transaction.add(db.collection(collectionName).doc(), {
            ...data,
            [`${collectionName}ID`]: newCount // add the auto-incremented ID
        });

        return newCount;
    });

    console.log(`Added document to ${collectionName} with auto-incremented ID. ID = ${newCount}`);
    return newCount;
}

//New Member Submission Handler
document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault(); // Prevent page reload
    const Plan = document.getElementById('plans').value;
    const FirstName = document.getElementById('firstName').value;
    const LastName = document.getElementById('lastName').value;
    const Email = document.getElementById('email').value;
    const Phone = document.getElementById('phone').value;
    const Username = document.getElementById('username').value;
    const Password = document.getElementById('password').value;
    const ConfirmPassword = document.getElementById('confirmPassword').value;
    const CardNumber = document.getElementById('cardNumber').value;
    const Addr1 = document.getElementById('addr1').value;
    const Addr2 = document.getElementById('addr2').value;
    const City = document.getElementById('city').value;
    const State = document.getElementById('state').value;
    const ZipCode = document.getElementById('zip').value;
    const Error = document.getElementById('message');

    //Get PlanID based on plan selection
    if(Plan.value == 'silverPlan'){
        PlanID == "Plans/1";
    }
    else if(Plan.value == 'goldPlan'){
        PlanID == "Plans/2";
    }
    else if(Plan.value == 'platinumPlan'){
        PlanID == "Plans/3";
    }
    else if(Plan.value == 'diamondPlan'){
        PlanID == "Plans/4"
    }

    if (!Plan){//Check that Plan and State are not null
        Error.textContent = "*Must select a plan before submitting";
        return; 
    }
    else if(!Select){
        Error.textContent = "*Must select a state before submitting";
        return;
    }

    try {
        // Create a new document in the "Testing" collection
        await db.collection("Members").doc(newCount).add({
            PlanID: db.doc(PlanID),//Create reference to Plan document
            FirstName: String(FirstName),
            LastName: String(LastName),
            Email: String(Email),
            Phone: String(Phone),
            JoinDate: new Date(),



        });
        document.getElementById('message').textContent = "Data uploaded successfully!";
    } catch (error) {
        console.error("Error uploading data: ", error);
        document.getElementById('message').textContent = "Error uploading data.";
    }
});

//TEMPORARY CODE
document.getElementById('addButton').addEventListener('click', () => {
    addExistingDocuments("Members").catch(console.error);
    addExistingDocuments("Children").catch(console.error);
    addExistingDocuments("Plans").catch(console.error);
    addExistingDocuments("Classes").catch(console.error);
    addExistingDocuments("EmergencyContacts").catch(console.error);
    addExistingDocuments("AuthorizedAdults").catch(console.error);
    addExistingDocuments("ClassEnrollments").catch(console.error);
    addExistingDocuments("JournalEntries").catch(console.error);
    addExistingDocuments("Testing").catch(console.error);
    addExistingDocuments("LoginInfo").catch(console.error);
})

        </script>
    </body>
</html>